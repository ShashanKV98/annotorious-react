{"version":3,"file":"annotorious-react-osd.es9.js","sources":["../../src/openseadragon/setPosition.ts"],"sourcesContent":["import { ImageAnnotation } from '@annotorious/annotorious';\r\nimport OpenSeadragon from 'openseadragon';\r\n\r\nconst getAnnotationDomRect = (viewer: OpenSeadragon.Viewer, annotation: ImageAnnotation) => {\r\n  const viewerBounds = viewer.element.getBoundingClientRect();\r\n  \r\n  // Annotation bounds (image coordinates)\r\n  const { minX, minY, maxX, maxY } = annotation.target.selector.geometry.bounds;\r\n\r\n  // Annotation coordinates - viewer element coordinates\r\n  const topLeft = viewer.viewport.imageToViewerElementCoordinates(new OpenSeadragon.Point(minX, minY));\r\n  const bottomRight = viewer.viewport.imageToViewerElementCoordinates(new OpenSeadragon.Point(maxX, maxY));\r\n\r\n  // Account for viewer element offset\r\n  return {\r\n    x: topLeft.x + viewerBounds.x,\r\n    right: bottomRight.x + viewerBounds.x,\r\n    y: topLeft.y + viewerBounds.y,\r\n    bottom: bottomRight.y + viewerBounds.y,\r\n    width: bottomRight.x - topLeft.x,\r\n    height: bottomRight.y - topLeft.y,\r\n  };\r\n}\r\n\r\nexport const setPosition = (\r\n  viewer: OpenSeadragon.Viewer, \r\n  annotation: ImageAnnotation, \r\n  popup: HTMLElement,\r\n  sideOffset: number = 5\r\n) => {\r\n  const viewerBounds = viewer.element.getBoundingClientRect();\r\n  const annoBounds = getAnnotationDomRect(viewer, annotation);\r\n\r\n  // Available space above, right, below, left the annotation in the viewport\r\n  const availableAbove = annoBounds.y - viewerBounds.y;\r\n  const availableRight = viewerBounds.right - annoBounds.x;\r\n  const availableBelow = viewerBounds.bottom - annoBounds.bottom;\r\n  const availableLeft = annoBounds.x - viewerBounds.left;\r\n\r\n  // Popup element bounds\r\n  const popupBounds = popup.firstElementChild.getBoundingClientRect();\r\n\r\n  // Eight possible base alignment anchor points\r\n  //\r\n  //            topleft        topright\r\n  //            *                     *\r\n  // leftdown * |---------------------| * rightdown\r\n  //            |                     |\r\n  //            |                     |\r\n  //            |                     |\r\n  //   leftup * |---------------------| * rightup\r\n  //            *                     * \r\n  //            bottomleft  bottomright\r\n  //\r\n  // We'll position the popup at the cardinal direction\r\n  // with the highest ratio: available space vs. popup size.\r\n  const ratioAbove = availableAbove / popupBounds.height;\r\n  const ratioRight = availableRight / popupBounds.width;\r\n  const ratioBelow = availableBelow / popupBounds.height;\r\n  const ratioLeft = availableLeft / popupBounds.width;\r\n\r\n  const topleft = () => {\r\n    popup.style.left = `${annoBounds.x}px`;\r\n    popup.style.top = `${annoBounds.y - sideOffset - popupBounds.height}px`;\r\n  }\r\n\r\n  const topright = () => {\r\n    popup.style.left = `${annoBounds.right - popupBounds.width}px`;\r\n    popup.style.top = `${annoBounds.y - sideOffset - popupBounds.height}px`;\r\n  }\r\n\r\n  const leftdown = () => {\r\n    popup.style.left = `${annoBounds.x - popupBounds.width - sideOffset}px`;\r\n    popup.style.top = `${annoBounds.y}px`;\r\n  } \r\n\r\n  const rightdown = () => {\r\n    popup.style.left = `${annoBounds.right + sideOffset}px`;\r\n    popup.style.top = `${annoBounds.y}px`;\r\n  }\r\n\r\n  const leftup = () => {\r\n    popup.style.left = `${annoBounds.x - popupBounds.width - sideOffset}px`;\r\n    popup.style.top = `${annoBounds.bottom - popupBounds.height}px`;\r\n  }\r\n\r\n  const rightup = () => {\r\n    popup.style.left = `${annoBounds.x + annoBounds.width + sideOffset}px`;\r\n    popup.style.top = `${annoBounds.bottom - popupBounds.height}px`;\r\n  }\r\n\r\n  const bottomleft = () => {\r\n    popup.style.left = `${annoBounds.x}px`;\r\n    popup.style.top = `${annoBounds.bottom + sideOffset}px`;\r\n  }\r\n\r\n  const bottomright = () => {\r\n    popup.style.left = `${annoBounds.right - popupBounds.width}px`;\r\n    popup.style.top = `${annoBounds.bottom + sideOffset}px`;\r\n  }\r\n\r\n  const ratios = [ratioAbove, ratioRight, ratioBelow, ratioLeft];\r\n  const maxIdx = ratios.indexOf(Math.max(...ratios));\r\n\r\n  if (maxIdx === 0) {\r\n    // Main orientation: above\r\n    if (ratioRight > ratioLeft)\r\n      topleft();\r\n    else \r\n      topright();\r\n  } else if (maxIdx === 1) {\r\n    // Main orientation: right\r\n    if (ratioAbove > ratioBelow)\r\n      rightup();\r\n    else\r\n      rightdown();\r\n  } else if (maxIdx === 2) {\r\n    // Main orientation: below\r\n    if (ratioRight > ratioLeft)\r\n      bottomleft();\r\n    else\r\n      bottomright();\r\n  } else {\r\n    // Main orientation: left\r\n    if (ratioAbove > ratioBelow)\r\n      leftup();\r\n    else \r\n      leftdown();\r\n  }\r\n}"],"names":["getAnnotationDomRect","viewer","annotation","viewerBounds","minX","minY","maxX","maxY","topLeft","OpenSeadragon","bottomRight","setPosition","popup","sideOffset","annoBounds","availableAbove","availableRight","availableBelow","availableLeft","popupBounds","ratioAbove","ratioRight","ratioBelow","ratioLeft","topleft","topright","leftdown","rightdown","leftup","rightup","bottomleft","bottomright","ratios","maxIdx"],"mappings":"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"}