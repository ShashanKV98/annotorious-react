{"version":3,"file":"annotorious-react.es5.js","sources":["../src/ImageAnnotator.tsx"],"sourcesContent":["import { Children, ReactElement, cloneElement, useContext, useEffect } from 'react';\r\nimport { AnnotoriousOpts, createImageAnnotator } from '@annotorious/annotorious';\r\nimport type { DrawingStyle, DrawingTool, Filter, ImageAnnotation } from '@annotorious/annotorious';\r\nimport { AnnotoriousContext } from './Annotorious';\r\n\r\nexport interface ImageAnnotatorProps<E extends unknown> extends AnnotoriousOpts<ImageAnnotation, E> {\r\n\r\n  children: ReactElement<HTMLImageElement>;\r\n\r\n  filter?: Filter<ImageAnnotation>;\r\n\r\n  style?: DrawingStyle | ((annotation: ImageAnnotation) => DrawingStyle);\r\n\r\n  tool?: DrawingTool\r\n\r\n}\r\n\r\nexport const ImageAnnotator = <E extends unknown>(props: ImageAnnotatorProps<E>) => {\r\n\r\n  const { children, tool, ...opts } = props;\r\n\r\n  const child = Children.only(children);\r\n\r\n  const { anno, setAnno } = useContext(AnnotoriousContext);\r\n\r\n  const onLoad = (evt: Event) => {\r\n    if (!anno) {\r\n      const img = evt.target as HTMLImageElement;\r\n\r\n      const next = createImageAnnotator(img, opts);\r\n      setAnno(next); \r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    if (props.tool && anno) anno.setDrawingTool(props.tool);\r\n  }, [props.tool, anno]);\r\n\r\n  useEffect(() => {\r\n    if (anno) anno.setFilter(props.filter);\r\n  }, [props.filter]);\r\n\r\n  useEffect(() => {\r\n    if (anno) anno.setStyle(props.style);\r\n  }, [props.style]);\r\n \r\n  return <>{cloneElement(child, { onLoad }  as Partial<HTMLImageElement>)}</>\r\n\r\n}"],"names":["ImageAnnotator","props","children","tool","opts","child","Children","anno","setAnno","useContext","AnnotoriousContext","onLoad","evt","img","next","createImageAnnotator","useEffect","cloneElement"],"mappings":";;;;AAiBa,MAAAA,IAAiB,CAAoBC,MAAkC;AAElF,QAAM,EAAE,UAAAC,GAAU,MAAAC,GAAM,GAAGC,MAASH,GAE9BI,IAAQC,EAAS,KAAKJ,CAAQ,GAE9B,EAAE,MAAAK,GAAM,SAAAC,EAAQ,IAAIC,EAAWC,CAAkB,GAEjDC,IAAS,CAACC,MAAe;AAC7B,QAAI,CAACL,GAAM;AACT,YAAMM,IAAMD,EAAI,QAEVE,IAAOC,EAAqBF,GAAKT,CAAI;AAC3C,MAAAI,EAAQM,CAAI;AAAA,IACd;AAAA,EAAA;AAGF,SAAAE,EAAU,MAAM;AACd,IAAIf,EAAM,QAAQM,KAAWA,EAAA,eAAeN,EAAM,IAAI;AAAA,EACrD,GAAA,CAACA,EAAM,MAAMM,CAAI,CAAC,GAErBS,EAAU,MAAM;AACV,IAAAT,KAAWA,EAAA,UAAUN,EAAM,MAAM;AAAA,EAAA,GACpC,CAACA,EAAM,MAAM,CAAC,GAEjBe,EAAU,MAAM;AACV,IAAAT,KAAWA,EAAA,SAASN,EAAM,KAAK;AAAA,EAAA,GAClC,CAACA,EAAM,KAAK,CAAC,0BAEN,UAAagB,EAAAZ,GAAO,EAAE,QAAAM,GAAsC,EAAE,CAAA;AAE1E;"}